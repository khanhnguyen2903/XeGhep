{% load static %}
<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Danh s√°ch chuy·∫øn ƒëi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: #f8f9fa;
            font-family: 'Segoe UI', sans-serif;
        }

        /* N√∫t Home c·ªë ƒë·ªãnh */
        .btn-home {
            background-color: #ffffff;
            color: #4e73df;
            font-weight: 600;
            border: none;
            border-radius: 50px;
            padding: 10px 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .btn-home:hover {
            background-color: #4e73df;
            color: white;
            transform: scale(1.05);
        }

        .top-bar {
            margin: 15px;
            font-size: 1.1rem;
            font-weight: 600;
            color: #007bff;
        }

        .container {
            margin-top: 20px;
            margin-bottom: 30px;
        }

        .card {
            border-radius: 15px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }

        .card-header {
            background: linear-gradient(90deg, #007bff, #00bcd4);
            color: white;
            font-weight: 600;
            font-size: 1.3rem;
            text-align: center;
            border-radius: 15px 15px 0 0;
        }

        .btn-accept {
            background-color: #28a745;
            color: white;
            font-weight: 500;
            border-radius: 8px;
            padding: 5px 10px;
        }

        .btn-accept:hover {
            background-color: #218838;
        }

        .btn-secondary {
            border-radius: 8px;
            padding: 5px 10px;
        }

        .btn-info {
            border-radius: 8px;
            padding: 5px 10px;
            font-weight: 500;
        }

        .status {
            font-weight: 600;
        }

        .status.waiting {
            color: #ffc107;
        }

        .status.active {
            color: #17a2b8;
        }

        .status.done {
            color: #28a745;
        }

        .status.cancelled {
            color: #dc3545;
        }

        /* üîπ Responsive cho ƒëi·ªán tho·∫°i */
        @media (max-width: 768px) {
            .table thead {
                display: none;
            }

            .table tbody tr {
                display: block;
                margin-bottom: 18px;
                border: 1px solid #dee2e6;
                border-radius: 12px;
                padding: 12px;
                background: #fff;
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.04);
            }

            .table tbody td {
                display: flex;
                flex-direction: row;
                align-items: flex-start;
                justify-content: flex-start;
                padding: 8px 6px;
                border: none;
                text-align: left !important;
            }

            .table tbody td::before {
                content: attr(data-label);
                display: inline-block;
                font-weight: bold;
                color: #007bff;
                flex: 0 0 42%;
                min-width: 130px;
                max-width: 52%;
                margin-right: 10px;
                white-space: normal;
                word-break: break-word;
                line-height: 1.2rem;
            }

            .btn-accept,
            .btn-secondary,
            .btn-info {
                width: 100%;
                margin-top: 8px;
                font-size: 0.95rem;
            }
        }
    </style>
</head>

<body>
    <!-- <div class="top-bar">
        Xin ch√†o {{ driver_name }}
    </div> -->
    <div class="top-bar d-flex justify-content-between align-items-center">
        <div>Xin ch√†o {{ driver_name }}</div>
        <div>S·ªë ƒëi·ªÉm c·ªßa ban: {{ driver_coins }}</div>
        <form action="{% url 'logout' %}" method="post" class="mb-0">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline-danger btn-sm">ƒêƒÉng xu·∫•t</button>
        </form>
    </div>
    <!-- N√∫t Home -->
    {% if driver_name == 'admin' %}
    <a href="{% url 'home' %}" class="btn-home">üè† Home</a>
    {% endif %}

    <div class="container">
        <!-- üîπ N√∫t T·∫°o chuy·∫øn ƒëi m·ªõi -->
        <div class="text-center mb-4">
            <a href="{% url 'create_trip' %}" class="btn btn-primary btn-lg px-4 py-2 rounded-pill shadow-sm">
                ‚ûï T·∫°o chuy·∫øn ƒëi m·ªõi
            </a>
        </div>
        <div class="card">
            <div class="card-header text-center">
                <form action="{% url 'list_trip' %}" method="get">
                    <button type="submit" class="btn btn-lg w-100">
                        üöó Danh s√°ch c√°c chuy·∫øn ƒëi
                    </button>
                </form>
            </div>
            <div class="card-body">
                {% if trips %}
                <div class="table-responsive">
                    <table class="table table-striped align-middle text-center">
                        <thead class="table-primary">
                            <tr>
                                <th>T√™n kh√°ch</th>
                                <th>SƒêT kh√°ch</th>
                                <th>S·ªë ng∆∞·ªùi</th>
                                <th>ƒê·ªãa ƒëi·ªÉm ƒë√≥n</th>
                                <th>ƒê·ªãa ƒëi·ªÉm tr·∫£</th>
                                <th>Th·ªùi ƒëi·ªÉm ƒë√≥n</th>
                                <th>Th√¥ng tin t√†i x·∫ø t·∫°o chuy·∫øn</th>
                                <th>Th√¥ng tin t√†i x·∫ø nh·∫≠n chuy·∫øn</th>
                                <th>Tr·∫°ng th√°i</th>
                                <th>Thao t√°c</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for trip in trips %}
                            <tr>
                                <td data-label="T√™n kh√°ch">{{ trip.customer_name }}</td>
                                <td data-label="SƒêT kh√°ch">{{ trip.customer_phone }}</td>
                                <td data-label="S·ªë ng∆∞·ªùi ƒëi">{{ trip.num_passengers }}</td>
                                <td data-label="ƒê·ªãa ƒëi·ªÉm ƒë√≥n">{{ trip.pickup_location }}</td>
                                <td data-label="ƒê·ªãa ƒëi·ªÉm tr·∫£">{{ trip.dropoff_location }}</td>
                                <td data-label="Th·ªùi ƒëi·ªÉm ƒë√≥n">{{ trip.pickup_time }}</td>

                                <!-- üîπ Th√¥ng tin t√†i x·∫ø t·∫°o chuy·∫øn -->
                                <td data-label="Th√¥ng tin t√†i x·∫ø t·∫°o chuy·∫øn">
                                    <button class="btn btn-info btn-sm" data-bs-toggle="modal"
                                        data-bs-target="#driverModalCreate{{ forloop.counter }}">
                                        Xem chi ti·∫øt
                                    </button>

                                    <!-- Modal t√†i x·∫ø t·∫°o chuy·∫øn -->
                                    <div class="modal fade" id="driverModalCreate{{ forloop.counter }}" tabindex="-1"
                                        aria-labelledby="driverModalCreateLabel{{ forloop.counter }}"
                                        aria-hidden="true">
                                        <div class="modal-dialog modal-dialog-centered">
                                            <div class="modal-content">
                                                <div class="modal-header bg-primary text-white">
                                                    <h5 class="modal-title">Th√¥ng tin t√†i x·∫ø t·∫°o chuy·∫øn</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                        aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body text-start">
                                                    <table class="table table-bordered">
                                                        <tr>
                                                            <th>T√™n t√†i x·∫ø</th>
                                                            <td>{{ trip.driver_name_create_trip }}</td>
                                                        </tr>
                                                        <tr>
                                                            <th>S·ªë ƒëi·ªán tho·∫°i</th>
                                                            <td>{{ trip.driver_phone_create_trip }}</td>
                                                        </tr>
                                                    </table>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                        data-bs-dismiss="modal">ƒê√≥ng</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>

                                <!-- üîπ Th√¥ng tin t√†i x·∫ø nh·∫≠n chuy·∫øn -->
                                <td data-label="Th√¥ng tin t√†i x·∫ø nh·∫≠n chuy·∫øn">
                                    {% if trip.status == 'ƒêang ch·ªù t√†i x·∫ø' %}
                                    <button class="btn btn-secondary btn-sm" disabled>Ch∆∞a c√≥ t√†i x·∫ø</button>
                                    {% else %}
                                    <button class="btn btn-info btn-sm" data-bs-toggle="modal"
                                        data-bs-target="#driverModalAccept{{ forloop.counter }}">
                                        Xem chi ti·∫øt
                                    </button>

                                    <!-- Modal t√†i x·∫ø nh·∫≠n chuy·∫øn -->
                                    <div class="modal fade" id="driverModalAccept{{ forloop.counter }}" tabindex="-1"
                                        aria-labelledby="driverModalAcceptLabel{{ forloop.counter }}"
                                        aria-hidden="true">
                                        <div class="modal-dialog modal-dialog-centered">
                                            <div class="modal-content">
                                                <div class="modal-header bg-success text-white">
                                                    <h5 class="modal-title">Th√¥ng tin t√†i x·∫ø nh·∫≠n chuy·∫øn</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                        aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body text-start">
                                                    <table class="table table-bordered">
                                                        <tr>
                                                            <th>T√™n t√†i x·∫ø</th>
                                                            <td>{{ trip.driver_name_assigned_trip }}</td>
                                                        </tr>
                                                        <tr>
                                                            <th>S·ªë ƒëi·ªán tho·∫°i</th>
                                                            <td>{{ trip.driver_phone_assigned_trip }}</td>
                                                        </tr>
                                                    </table>
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary"
                                                        data-bs-dismiss="modal">ƒê√≥ng</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    {% endif %}
                                </td>

                                <td data-label="Tr·∫°ng th√°i">
                                    <span class="status 
                                        {% if trip.status == 'ƒêang ch·ªù t√†i x·∫ø' %}waiting
                                        {% elif trip.status == 'ƒê√£ nh·∫≠n t√†i x·∫ø' %}active
                                        {% elif trip.status == 'K·∫øt th√∫c chuy·∫øn ƒëi' %}done
                                        {% else %}cancelled{% endif %}">
                                        {{ trip.status }}
                                    </span>
                                </td>

                                <td data-label="Thao t√°c">

                                    {% if trip.status == "ƒêang ch·ªù t√†i x·∫ø" %}
                                    <!-- N√∫t nh·∫≠n chuy·∫øn -->
                                    <form action="{% url 'accept_trip' trip.id %}" method="post"
                                        style="display:inline-block;">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-accept btn-sm">Nh·∫≠n chuy·∫øn</button>
                                    </form>

                                    {% elif trip.status == "ƒê√£ nh·∫≠n t√†i x·∫ø" %}
                                    <div style="display:flex; gap:6px; justify-content:center;">

                                        <!-- N√∫t k·∫øt th√∫c -->
                                        <form action="{% url 'finish_trip' trip.id %}" method="post"
                                            style="display:inline-block;">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-success btn-sm">K·∫øt th√∫c</button>
                                        </form>

                                        <!-- N√∫t h·ªßy chuy·∫øn -->
                                        <form action="{% url 'cancel_trip' trip.id %}" method="post"
                                            style="display:inline-block;">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-danger btn-sm">H·ªßy chuy·∫øn</button>
                                        </form>

                                    </div>

                                    {% elif trip.status == "K·∫øt th√∫c chuy·∫øn ƒëi" %}
                                    <!-- N√∫t ho√†n th√†nh -->
                                    <form action="" method="post" style="display:inline-block;">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-primary btn-sm" disabled>Ho√†n
                                            th√†nh</button>
                                    </form>

                                    {% else %}
                                    <!-- C√°c tr·∫°ng th√°i kh√°c n·∫øu c√≥ -->
                                    <button class="btn btn-secondary btn-sm" disabled>{{ trip.status }}</button>

                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="text-center text-muted mt-3">Kh√¥ng c√≥ chuy·∫øn ƒëi n√†o.</p>
                {% endif %}
            </div>
        </div>
        <!-- üîπ Hai n√∫t ƒëi·ªÅu h∆∞·ªõng -->
        <div class="text-center mt-4 mb-4">
            <a href="{% url 'list_trip_receiving' %}" class="btn btn-warning btn-lg mx-2 px-4 py-2 rounded-pill">
                üöï Chuy·∫øn ƒëang nh·∫≠n
            </a>
            <a href="{% url 'list_trip_completed' %}" class="btn btn-success btn-lg mx-2 px-4 py-2 rounded-pill">
                ‚úÖ C√°c chuy·∫øn ho√†n th√†nh
            </a>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>